{% extends "sopds_main.html" %}
{% load i18n %}
{% load static %}

{% block body %}
<script>
       function del_bsbook(b_id, b_t) {
           $('#DeleteBook_btnYes').attr("href","{% url "web:bsdel" %}?book="+b_id);
           $('#DeleteBook_image').attr("src","{% url "opds:covertmpl" %}"+b_id+"/");
           $('#DeleteBook_title').text(b_t);
           $('#DeleteBookModal').foundation('open');
       }
</script>

{% spaceless %}
<!-- Remove book from bookshelf -->
<div id="DeleteBookModal" class="reveal tiny text-center" data-reveal>
  <h5 id="DeleteBookModalTitle">{% trans "Confirm the deletion of the book from your bookshelf." %}</h5>
  <table><tr>	
  <td width="100px" style="padding:0rem 0rem;">
      <img src="" id="DeleteBook_image" style="max-height: 100px; max-width: 100px">
  </td> 
  <td style="font-size:100%; padding:3px">
      <p id="DeleteBook_title"></p>
  </td>
  </tr>
  </table>
  <p class="text-center"><a href="#" class="secondary button" id="DeleteBook_btnYes">{% trans "Delete" %}</a>
                         &nbsp;&nbsp;&nbsp;<a class="close button" data-close>{% trans "Cancel" %}</a></p>
  <button class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<!-- Remove book from bookshelf -->

<!-- Bookshelf -->
 {% if isbookshelf %}
 <div id="ConfirmModal" class="reveal tiny text-center" data-reveal>
  <h5 id="ConfirmModalTitle">{% trans "Confirm to clear your bookshelf." %}</h5>
  <p></p>
  <p class="text-center"><a href="{% url "web:bsclear" %}" class="secondary button" id="Confirm_btnYes">{% trans "Clear" %}</a>
                         &nbsp;&nbsp;&nbsp;<a class="close button" data-close>{% trans "Cancel" %}</a></p>
  <button class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

 <a class="alert button small" data-open="ConfirmModal">{%  trans "Clear bookshelf" %}</a>
 {% endif %}
<!-- Bookshelf -->
{% endspaceless %}

{%  for b in books %}
{% spaceless %}
<!-- Book card-->
    <div class="cell sopds-book-card">
        <div class="sopds-book-card-divider">
            <b>{{ b.title }}</b>
            {% if isbookshelf %}
            На книжной полке
            {% endif %}
        </div>
        <div class="card-section grid-x grid-margin-x">
            <!-- Book cover && action links -->
            <div class="cell medium-2 small-4"> 
                <img src="{% url 'opds_catalog:thumb' b.id %}" type="image/jpeg" >
                <!-- Action links -->
                <div class="cell auto">
                    <div class="cell">
                        <i style="font-size:80%;">{% trans "Download:" %} </i>
                    </div>
                    <div class="cell">
                        <i><a href="{% url 'opds_catalog:download' b.id 0 %}" title="{{ b.format }}"><img src="{% static "images/sopds-ng-download.svg" %}" width="30" alt="{{ b.format}}"></a></i>
                        {% if not b.format in nozip %}
                        <i><a href="{% url 'opds_catalog:download' b.id 1 %}" title="{{ b.format }} + zip"><img src="{% static "images/sopds-ng-download-zip.svg" %}" width="30" alt="{{ b.format }}+zip"></a></i>
                        {%  endif %}
                        {% if b.format == 'fb2' and fb2toepub %}
                        <i><a href="{% url 'opds_catalog:convert' b.id 'epub' %}" title="epub"><img src="{% static "images/sopds-ng-download-epub.svg" %}" width="30" alt="epub"></a></i>
                        {% endif %}
                        {% if b.format == 'fb2' and fb2tomobi %}
                        <i><a href="{% url 'opds_catalog:convert' b.id 'mobi' %}" title="mobi"><img src="{% static "images/sopds-ng-download-mobi.svg" %}" width="30" alt="mobi"></a></i>&nbsp;
                        {% endif %}			
                        {% if isbookshelf %}
                        &nbsp;&nbsp;<i><a href="#" onclick="del_bsbook({{ b.id }},'{{b.title}}');"><span class="secondary label small">&nbsp;{% trans "Delete from bookshelf" %}&nbsp;</span></a></i>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- Book cover && action links -->
            <div class="cell auto">
                <!-- Tabs definition -->
                <ul class="tabs" data-tabs id="book-data_{{b.id}}">
                    <li class="tabs-title is-active"><a href="#info_{{b.id}}">{% trans "Information" %}</a></li>
                    <li class="tabs-title">
                      {% if b.annotation %}
                      <a href="#annotation_{{b.id}}" area-selected="true">{% trans "Annotation" %}</a>
                      {% else %}
                      <a href="#info_{{b.id}}" area-selected="true">{% trans "No annotation" %}</a>
                      {% endif %}
                    </li>
                </ul>

                <div class="tabs-content" data-tabs-content="book-data_{{b.id}}">
                    <!-- Annotation tab -->
                    <div class="tabs-panel" id="annotation_{{b.id}}">
                        <p style="font-size:80%;">{{ b.annotation }}</p>  
                    </div>
                    <!-- Annotation tab -->
                    <!-- Book information -->
                    <div class="tabs-panel is-active" id="info_{{b.id}}">
                        <div class="cell" style="font-size:70%">
                            <b>{% trans "Book title:" %}</b> {{ b.title }} <br>
                            <b>{% trans "Language:" %}</b> {{ b.lang }} <br>
                            {% if b.authors.count > 0 %}
                            <b>{% trans "Authors:" %}</b>{% for a in b.authors %} <a href="{% url "web:searchbooks" %}?searchtype=a&searchterms={{a.id}}">{{a.full_name}}</a>{% if not forloop.last %},{%endif%} {%endfor%}<br>
                            {% endif %}
                            {% if b.genres.count > 0 %}
                            <b>{% trans "Genres:" %}</b>{% for g in b.genres %} <a href="{% url "web:searchbooks" %}?searchtype=g&searchterms={{g.id}}">{{g.subsection}}</a>{% if not forloop.last %},{%endif%} {%endfor%} <br>
                            {% endif %}
                            {% if b.series.count > 0 %}
                            <b>{% trans "Series:" %}</b> {% for s in b.series %} <a href="{% url "web:searchbooks" %}?searchtype=s&searchterms={{s.id}}">{{s.ser}}</a>{% if not forloop.last %},{%endif%} {%endfor%} <br>
                            <b>{% trans "No in Series:" %}</b> {% for s in b.ser_no %}{{s.ser_no}}{% if not forloop.last %},{%endif%} {%endfor%} <br>
                            {% endif %}
                            <b>{% trans "File:" %}</b> {{ b.path }}/{{ b.filename }} <br>
                            <b>{% trans "File size:" %}</b> {{ b.filesize | filesizeformat }}<br>
                            <b>{% trans "Changes date:" %}</b> {{ b.docdate }} <br>	
                            {% if b.doubles > 0 %}
                            <b>{% trans "Doubles for book:" %}</b> <a href="{% url "web:searchbooks" %}?searchtype=d&searchterms={{b.id}}">{{ b.title }} ({{b.doubles}}шт.)</a><br>
                            {% endif %}
                            {% if b.readtime %}
                            <b>{% trans "Read date:" %}</b> <span class="label small">{{ b.readtime.0.readtime }}</span><br>
                            {% endif %}
                        </div>
                    </div>
                    <!-- Book information -->
                </div><!-- tabs -->
            </div><!-- cell -->
        </div><!-- Card section -->
    </div><!-- Book card -->
    {% endspaceless %}
<!--/div-->
{% endfor %}

{% if paginator.num_pages > 1 %}
<ul class="pagination" role="navigation" aria-label="Pagination">
  <li class="pagination-previous {% if not paginator.has_previous %}disabled{%endif%}">
      {% if paginator.has_previous %}<a href="{% url "web:searchbooks" %}?searchtype={{searchtype}}&searchterms={{searchterms}}&page={{paginator.previous_page_number}}" aria-label="Previous page"> {%endif%}
         {% trans "Previous page" %}
      {% if paginator.has_previous %}</a>{%endif%}
  </li>
  
  {% for pn in paginator.page_range %}
     {% if paginator.number == pn %}
        <li class="current">{{pn}}</li>
     {% else %}
        <li><a href="{% url "web:searchbooks" %}?searchtype={{searchtype}}&searchterms={{searchterms}}&page={{pn}}" aria-label="Page {{pn}}">{{pn}}</a></li>
     {% endif %}   
        {# <li class="ellipsis" aria-hidden="true"></li> #}
  {% endfor %}
  
  <li class="pagination-next" {% if not paginator.has_next %}disabled{%endif%}>
      {% if paginator.has_next %}<a href="{% url "web:searchbooks" %}?searchtype={{searchtype}}&searchterms={{searchterms}}&page={{paginator.next_page_number}}" aria-label="Next page">{%endif%}
         {% trans "Next page" %}
      {% if paginator.has_next %}</a>{%endif%}
  </li>
</ul>
{% endif %}

{% endblock %}  {# body #}
